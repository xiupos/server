{
  email {env.MAIL}
}

(cloudflare) {
  tls {
    dns cloudflare {env.CF_API_TOKEN}
    resolvers 1.1.1.1
  }
}

(default) {
  header_up Host {host}
  transport http {
    versions 1.1
  }

  # # If it's behind another reverse proxy or CDN, remove the following.
  # header_up X-Real-IP {remote_addr}
  # header_up X-Forwarded-For {proxy_add_x_forwarded_for}
  # header_up X-Forwarded-Proto https

  # For WebSocket
  # header_up Upgrade {http_upgrade}
  # header_up Connection {connection_upgrade}
}

mk.xiupos.net {
  import cloudflare
  reverse_proxy sapporo:3000 {
    import default
  }
}

mk-dev.xiupos.net {
  import cloudflare

  handle_path /files/* {
    reverse_proxy mk-dev-s3.xiupos.net
  }

  reverse_proxy sapporo:3001 {
    import default
  }
}

m.huling.org {
  import cloudflare
  reverse_proxy sapporo:3002 {
    import default
  }
}

phys.xiupos.net {
  import cloudflare
  reverse_proxy sapporo:3003 {
    import default
  }
}

workflow.xiupos.net {
  import cloudflare
  reverse_proxy sapporo:5678 {
    import default
  }
}
